---
title: "フロントエンドのテストの観点"
emoji: "🌟"
type: "tech"
topics: ["react", "nextjs", "jest", "test"]
published: false
---

## 対象読者

- Jest や Testing Library のテストの書き方は理解しているが、何をテストすべきかわからないという方

## 動機

- 近年、フロントエンドでもテストを書くことが重要視されるようになってきました。
- テスト導入する際、共通で利用するコンポーネントや関数などをテストする記事は多いですが、何をテストすべきかについての記事が見当たらなかったため、本記事を執筆することにしました。

## フロントエンドのテストの種類

- まず初めに自分の知る限りの中で必要だと思うテストについて説明します。
- 本記事では、単体テストと結合テストについての観点のみを説明します。

### 単体テスト

- 関数やメソッドなどの最小単位の部分を個別にテストする手法
- 利用ツール例
  - Jest
  - React-Testing-Library

### 結合テスト

- 複数のコンポーネントが、互いにうまく動作していることをテストする手法
- 利用ツール例
  - Jest
  - React-Testing-Library

### End to End （E2E）テスト

- ユーザーが実際にシステムを使用するときと同様の条件で、システム全体の機能をテストする手法
- フロントエンド、バックエンド、およびデータベースなどを含む全体システムを対象とする
- 利用ツール例
  - Puppeteer
  - Cypress
  - Playwright

### ビジュアルリグレッションテスト

- UI（ユーザーインターフェイス）コンポーネントの変更によって、予期しない視覚的な変更が発生していないことをテストする手法
- UI のデザインや表示に関連する問題を特定するために用いる
- 利用ツール例
  - reg-suit

## 自分が単体テストと結合テストを記述する際に意識している点

- 命令網羅（Statement coverage : C0）
  - テスト対象のコードが少なくとも一度は実行されるかどうかを確認する
  - 全ての処理（命令）をテストする
- 分岐網羅（Branch coverage : C1）
  - テスト対象のコードの条件分岐が少なくとも一度は実行されるかどうかを確認する
  - 条件分岐内（if else）に注目して、条件式のすべての組み合わせをテストする

二つの網羅率を意識してテストを記述しています。

## 　観点を意識して実際にテストを書いていく

### 本記事で利用するテスト対象コード

```TypeScript
type Props = {
  isCampaignUser: boolean;
  price: number;
};

export function PriceText({ price, isCampaignUser }: Props) {


  return (
    <div>
      <Price isCampaignUser={isCampaignUser}>基本価格:{price}円</Price>
      {isCampaignUser && <div>特別価格:{price * 0.7}円</div>}
    </div>
  );
}

const Price = styled.div<{ isCampaignUser?: boolean }>`
  ${({ isCampaignUser }) =>
    isCampaignUser &&
    css`
      text-decoration: line-through;
    `}
`;

```

- このコンポーネントは価格を表示するためのものです
- もしキャンペーンユーザーであれば、価格から 30%引いた割引価格も表示します
- また、値引き前の価格も表示しており、特別価格を表示する場合には、基本価格に取り消し線を引いて区別しています

### 命令網羅、条件網羅 を意識してテスト観点を洗い出す

- コードには 2 つの条件分岐があり、それぞれ 2 つのパターンがあります。
- したがって、4 つのテストパターンがあります。
  - キャンペーンユーザーで、基本価格に取り消し線が入っている
  - キャンペーンユーザーではなく、基本価格に取り消し線が入っていない
  - キャンペーンユーザーで、30%引きされた特別価格が表示される
  - キャンペーンユーザーではなく、30%引きされた特別価格が表示されない

### テスト観点だけのテストを書く

```TypeScript
describe("PriceText", () => {
  test.todo("基本価格が表示されること");
  describe("キャンペーンユーザーの場合", () => {
    test.todo("基本価格に取り消し線が入ること");
    test.todo("30%引きされた特別価格が表示されること");
  });
  describe("キャンペーンユーザーでない場合", () => {
    test.todo("基本価格に取り消し線が入らないこと");
    test.todo("30%引きされた特別価格が表示されないこと");
  });
});
```

※ テスト観点のすり合わせのために、まずは観点だけを書いてレビュー依頼を出すのも一つの方法です。観点だけなので行数が少なくて済み、レビュワーも楽になります。

### 実際にテストコード書く

```TypeScript
describe("PriceText", () => {
  test("基本価格が表示されること", () => {
    render(<PriceText price={1000} />);
    expect(screen.getByText("基本価格:1000円")).toBeInTheDocument();
  });

  describe("キャンペーンユーザーの場合", () => {
    test("基本価格に取り消し線が入ること", () => {
      render(<PriceText price={1000} isCampaignUser={true} />);
      expect(screen.getByText("基本価格:1000円")).toHaveStyle(
        "text-decoration: line-through"
      );
    });
    test("30%引きされた特別価格が表示されること", () => {
      render(<PriceText price={1000} isCampaignUser={true} />);
      expect(screen.getByText("特別価格:700円")).toBeInTheDocument();
    });
  });

  describe("キャンペーンユーザーでない場合", () => {
    test("基本価格に取り消し線が入らないこと", () => {
      render(<PriceText price={1000} isCampaignUser={false} />);
      expect(screen.getByText("基本価格:1000円")).not.toHaveStyle(
        "text-decoration: line-through"
      );
    });
    test("30%引きされた特別価格が表示されないこと", () => {
      render(<PriceText price={1000} isCampaignUser={false} />);
      expect(screen.queryByText("特別価格:700円")).toBeNull();
    });
  });
});

```

## Tips

### JestCoverageReport を利用して自分のテストコードの分岐網羅率を可視化する

- 4 パターンのテストのうち２パターンを消すと、黄色のハイライトがあたり条件網羅されていないところがわかるのでおすすめ
  - ~~キャンペーンユーザーで、基本価格に取り消し線が入っている~~
  - キャンペーンユーザーではなく、基本価格に取り消し線が入っていない
  - ~~キャンペーンユーザーで、30%引きされた特別価格が表示される~~
  - キャンペーンユーザーではなく、30%引きされた特別価格が表示されない

```TypeScript
describe("PriceText", () => {
  describe("キャンペーンユーザーでない場合", () => {
    test("基本価格に取り消し線が入らないこと", () => {
      render(<PriceText price={1000} isCampaignUser={false} />);
      expect(screen.getByText("基本価格:1000円")).not.toHaveStyle(
        "text-decoration: line-through"
      );
    });
    test("30%引きされた特別価格が表示されないこと", () => {
      render(<PriceText price={1000} isCampaignUser={false} />);
      expect(screen.queryByText("特別価格:700円")).toBeNull();
    });
  });
});
```

![coverage](/images/coverage.png)
