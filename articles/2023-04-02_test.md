---
title: "俺の考える単体テスト観点"
emoji: "🌟"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["react", "nextjs", "jest", "test"]
published: false
---

## 対象読者

- Jest や Testing Library のテストの書き方わかっても何をテストしていいかわからんというそこのあなた

## 動機

- 近年フロントエンドでもテストを書こうという動きが強まっています
- テスト導入する際に、共通で利用するコンポーネントや関数はテストを書こうなど大雑把に言われたりしてる記事を見ますが
- 何を意識してテストを書けばいいのかについて書いている記事がなかったので書こうと思いました

## まずフロンドエンドのテストの種類（自分の知る限りの中で必要だと思うもの）

- 単体テスト

  - プログラムの最小単位である関数やメソッドなどの個々の部分をテストする手法のこと
  - 利用ツール
    - ex... Jest React-Testing-Library

- 結合テスト

  - 複数のコンポーネントが、互いにうまく動作していることをテストする手法のこと
  - 利用ツール
    - ex... Jest React-Testing-Library

------ 今回はここまでを対象にする ------

- End to End （E2E）テスト

  - システムの全体像を確認するためのテストです。ユーザーが実際にシステムを使用するときと同様の条件で、システム全体の機能をテストする手法のこと
  - つまり、ユーザーが見ることができるすべての部分、つまりフロントエンド、バックエンド、およびデータベースなどを含む全体システムを対象
  - 利用ツール
    - ex... Puppeteer Cypress playWright

- ビジュアルリグレッションテスト

  - ウェブサイトや Web アプリケーションなどの UI（ユーザーインターフェイス）コンポーネントの変更によって、
  - 予期しない視覚的な変更が発生していないことをテストする手法のこと
  - つまり、UI のデザインや表示に関連する問題を特定するためのテスト
  - 利用ツール
    - ex... reg-suit

## 自分が単体テストと結合テストを書くときに意識していること

- 命令網羅（Statement coverage : C0）
  - テスト対象のコードが少なくとも一度は実行されるかどうかを確認する
  - 全ての処理（命令）をテストする
- 分岐網羅（Branch coverage : C1）
  - テスト対象のコードの条件分岐が少なくとも一度は実行されるかどうかを確認する
  - 条件分岐内（if else）に注目して、条件式のすべての組み合わせをテストする

## 実際に書いてみる

### 利用するテストコード

- 価格を表示するコンポーネント
- キャンペーンユーザーであれば、30%オフした価格を表示する
- お得感を出すために、値引き前の価格は表示しておく
- 特別価格と基本価格を見分けるために、特別価格を出す場合は基本価格に取り消し線を入れる

```TypeScript
type Props = {
  isCampaignUser?: boolean;
  price: number;
};

export function Button({ price, isCampaignUser }: Props) {
  const campaignPrice = isCampaignUser && price * 0.7;

  return (
    <div>
      <Price isCampaignUser={isCampaignUser}>{price}円</Price>
      {isCampaignUser && <div>特別価格:{campaignPrice}円</div>}
    </div>
  );
}

const Price = styled.div<{ isCampaignUser?: boolean }>`
  ${({ isCampaignUser }) =>
    isCampaignUser &&
    css`
      text-decoration: line-through;
    `}
`;

```

### 命令網羅、条件網羅 を意識してテスト観点を洗い出す

- テスト対象となるコードには条件分岐が 2 回ある
- 条件を網羅するためには 1 分岐に付き 2 通りテストが必要になる
- つまり以下 4 パターンのテストを書けばいい
  - キャンペーンユーザーの場合、基本価格に取り消し線が入る
  - キャンペーンユーザーのでない場合、基本価格に取り消し線が入らない
  - キャンペーンユーザーの場合、30%引きされた特別価格が出る
  - キャンペーンユーザーのでない場合、30%引きされた特別価格が出ない

### まず日本語でテスト書く

```TypeScript
describe("PriceText", () => {
  test.todo("基本価格が表示されること");
  describe("基本価格:1000円,キャンペーンユーザーの場合 ", () => {
    test.todo("基本価格に取り消し線が入ること");
    test.todo("30%引きされた特別価格が表示されること");
  });
  describe("基本価格:1000円,キャンペーンユーザーでない場合 ", () => {
    test.todo("基本価格に取り消し線入らないこと");
    test.todo("30%引きされた特別価格が表示されないこと");
  });
});

```

### 実際にテストコード書く

```TypeScript
describe("PriceText", () => {
  test("基本価格が表示されること", () => {
    render(<PriceText price={1000} isCampaignUser={true} />);
    expect(screen.getByText("基本価格:1000円")).toBeInTheDocument();
  });
  describe("基本価格:1000円,キャンペーンユーザーの場合 ", () => {
    test("基本価格に取り消し線入ること", () => {
      render(<PriceText price={1000} isCampaignUser={true} />);
      expect(screen.getByText("基本価格:1000円")).toHaveStyle(
        "text-decoration: line-through"
      );
    });
    test("基本価格から30％引きされた特別価格が表示されること（e.g...特別価格:700円", () => {
      render(<PriceText price={1000} isCampaignUser={true} />);
      expect(screen.getByText("特別価格:700円")).toBeInTheDocument();
    });
  });
  describe("基本価格:1000円,キャンペーンユーザーでない場合 ", () => {
    test("基本価格が表示されること", () => {
      render(<PriceText price={1000} isCampaignUser={false} />);
      expect(screen.getByText("基本価格:1000円")).toBeInTheDocument();
    });
    test("基本価格に取り消し線入らないこと", () => {
      render(<PriceText price={1000} isCampaignUser={false} />);
      expect(screen.getByText("基本価格:1000円")).not.toHaveStyle(
        "text-decoration: line-through"
      );
    });
  });
});

```
